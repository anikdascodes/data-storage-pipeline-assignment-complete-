services:
  spark-app:
    build: .
    container_name: ecommerce-recommendation-pipeline
    volumes:
      - ./data:/workspace/data
      - ./configs:/workspace/configs
      - ./src:/workspace/src
      - ./scripts:/workspace/scripts
      - ./input_data_sets:/workspace/input_data_sets
    environment:
      - SPARK_HOME=/opt/spark
      - PYTHONPATH=/opt/spark/python:/opt/spark/python/lib/py4j-0.10.9.7-src.zip
      # Optimize Spark memory settings
      - SPARK_DRIVER_MEMORY=2g
      - SPARK_EXECUTOR_MEMORY=2g
    working_dir: /workspace
    stdin_open: true
    tty: true
    # Resource limits (adjust based on your machine)
    deploy:
      resources:
        limits:
          memory: 4G
        reservations:
          memory: 2G
